[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log

[program:php-fpm]
command=php-fpm -F -y /usr/local/etc/php-fpm.d/www.conf
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/php-fpm.err.log
stdout_logfile=/var/log/supervisor/php-fpm.out.log

[program:redis]
command=redis-server --appendonly yes --dir /var/lib/redis --appendfilename appendonly.aof
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/redis.err.log
stdout_logfile=/var/log/supervisor/redis.out.log

[program:vite]
command=sh -c "while ! [ -f package.json ]; do echo 'Esperando package.json para Vite...' && sleep 5; done && echo 'package.json encontrado, iniciando Vite...' && npm run dev"
directory=/var/www/html
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/vite.err.log
stdout_logfile=/var/log/supervisor/vite.out.log
user=www-data

[program:queue]
command=sh -c "while ! php artisan --version > /dev/null 2>&1; do echo 'Esperando Laravel para Queue...' && sleep 5; done && echo 'Laravel listo para Queue, iniciando queue worker...' && php artisan queue:work --sleep=3 --tries=3"
directory=/var/www/html
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/queue.err.log
stdout_logfile=/var/log/supervisor/queue.out.log
user=www-data

[program:scheduler]
command=sh -c "while ! php artisan --version > /dev/null 2>&1; do echo 'Esperando Laravel para Scheduler...' && sleep 5; done && echo 'Laravel listo para Scheduler, iniciando scheduler...' && while true; do php artisan schedule:run; sleep 60; done"
directory=/var/www/html
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/scheduler.err.log
stdout_logfile=/var/log/supervisor/scheduler.out.log
user=www-data
